

# create dist and wheel file and push to test.pypi
module load python/3.6.4
ml python/3.7.2

* test locally

#ml python/miniconda3-4.5.12
#\rm -rf /home/kortass/KSLHUB_TEST/env
#conda create -y -p /home/kortass/KSLHUB_TEST/env 'python==3.6 ' pip
. /home/kortass/APPS/miniconda3-4.5.12/etc/profile.d/conda.sh
conda activate //home/kortass/KSLHUB_TEST/env
# to install and test locally
pip install -e .
# to install in the local python directory
pip install .

# make a pakage and push it
cd //home/kortass/KSLHUB
\rm -rf dist/*
python setup.py sdist bdist_wheel
#twine upload  -r test dist/*
#twine upload   dist/*


# to install from a package made
cd /home/kortass/KSLHUB_TEST
\rm -rf /home/kortass/KSLHUB_TEST/env_test
ml python/miniconda3-4.5.12
conda create -y -p /home/kortass/KSLHUB_TEST/env_test 'python>=3 ' pip
. /home/kortass/APPS/miniconda3-4.5.12/etc/profile.d/conda.sh
conda activate /home/kortass/KSLHUB_TEST/env_test
pip install /home/kortass/KSLHUB/dist/ksl*tar.gz

kslhub -h
kslhub --init
kslhub --generate-job-templates
kslhub



docker run -t -i -d -p 9003:9000 --name conda continuumio/anaconda3
d cp /home/kortass/KSLHUB/dist/ksl*tar.gz conda:/root
db conda
qpt-get update
apt install -y gcc
conda install configurable-http-proxy
pip install kslhub

pip install /root/ksl*tar.gz





pip install -i https://test.pypi.org/simple -i https://pypi.org/simple kslhub==0.0.10




* develop/debug

\rm -rf /home/kortass/KSLHUB_TEST/env/lib/python3.6/site-packages/jupyterhub*
\rm -rf /home/kortass/KSLHUB_TEST/env/lib/python3.6/site-packages/kslhub*
\rm -rf /home/kortass/KSLHUB_TEST/env/share/*hub

cd /home/kortass/KSLHUB
pip install .

cd /home/kortass/KSLHUB_TEST/env/lib/python3.6/site-packages
# mv jupyterhub jupyterhub-orig
# ln -s /home/kortass/KSLHUB/kslhub /home/kortass/KSLHUB/jupyterhub/jupyterhub .

\rm -rf /home/kortass/KSLHUB_TEST/env/lib/python3.6/site-packages/kslhub*
ln -s /home/kortass/KSLHUB/kslhub .

cd /home/kortass/KSLHUB/jupyterhub/jupyterhub
ln -s ../jupyterhub .

cd /home/kortass/KSLHUB_TEST/env/share
\rm -rf kslhub
mkdir kslhub 
ln -s /home/kortass/KSLHUB/kslhub/templates kslhub
ln -s /home/kortass/KSLHUB/kslhub/config.py kslhub

export PYTHONPATH=/home/kortass/KSLHUB/jupytrhub:$PYTHONPATH

cd ~/TMP
kslhub --start -f /home/kortass/KSLHUB/kslhub/config.py




* finish installation of jupyterhub
 
# installing NERSC slurm magic  kernel
mkdir -p $SW_BLDDIR/BUILD
cd $SW_BLDDIR/BUILD
git clone https://github.com/NERSC/slurm-magic.git
cd slurm-magic
python setup.py install

cd $SW_BLDDIR/BUILD
jupyter-kernelspec install slurm-magic --sys-prefix

# configuring the extension 
jupyter contrib nbextension install  --sys-prefix
jupyter nbextensions_configurator enable --sys-prefix
jupyter nbextension enable codefolding/main
jupyter nbextension enable --py --sys-prefix widgetsnbextension
#jupyter labextension install @jupyter-widgets/jupyterlab-manager

# configuring the working directory

mkdir -p /scratch/tmp/kslhub/runtime/jupyter /scratch/tmp/kslhub/jobs /scratch/tmp/kslhub/logs
cd $SW_BLDDIR
chmod 3777 runtime jobs logs

ln -s /scratch/tmp/kslhub/runtime .
ln -s /scratch/tmp/kslhub/jobs .
ln -s /scratch/tmp/kslhub/logs .


chmod 3777 $SW_BLDDIR/jobs
chmod 3777 $SW_BLDDIR/runtime/jupyter

  drwxrwxrwt     5 root        root          2822144 Mar 14 15:39 tmp
           ^ sticky bit





* run kslhub
kslhub --init

kslhub --start -f /home/kortass/KSLHUBkslhub/config.py

* documentation
pip install sphinx sphinx_rtd_theme
cd docs
make html



*
